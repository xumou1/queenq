# 开发计划：供应链网络分析

本文档概述了供应链网络分析项目的开发任务。每个任务都包含描述、验收标准和任何相关注意事项。

## 阶段一：项目设置与初始配置

---

### **TASK-001: 初始化项目仓库和结构**
* **描述:** 建立 Git 仓库，按照 `README.md` 中的规划定义初始目录结构，并添加初始规则文件。
* **验收标准:**
    * [ ] Git 仓库已在远程服务器（例如 GitHub, GitLab）上初始化。
    * [ ] 项目已在本地克隆。
    * [ ] 主要项目目录（`data/raw`, `data/processed`, `docs`, `rules`, `src`）已创建。
    * [ ] 初始 `.gitignore` 文件已添加。
    * [ ] `README.md` 和 `DEV_PLAN.md`（此文件）已创建并提交。
    * [ ] 通用、语言和框架规则 `.mdc` 文件（如前所述）已放置在 `rules/` 目录中。
* **注意事项:** 遵循 `gitflow.mdc` 的分支策略（初始化 `main` 和 `develop` 分支）。

---

### **TASK-002: 配置 Cursor 环境和规则**
* **描述:** 确保 Cursor IDE 设置正确，能够识别并利用 `rules/` 目录中的 `.mdc` 规则文件，以实现一致的开发指导。
* **验收标准:**
    * [ ] Cursor IDE 正确加载并应用 `general.mdc` 中的规则。
    * [ ] 编辑 Python 文件时，Cursor IDE 根据 `python.mdc` 提供建议。
    * [ ] Cursor IDE 根据 `git.mdc` 辅助生成提交信息。
* **注意事项:** 使用示例 Python 文件和示例提交进行测试。

---

### **TASK-003: 设置 Python 虚拟环境并安装初始依赖**
* **描述:** 创建 Python 虚拟环境并安装核心库（Pandas, NetworkX）。生成初始的 `requirements.txt`。
* **验收标准:**
    * [ ] Python 虚拟环境（`venv` 或 `conda`）已创建并激活。
    * [ ] Pandas 库已安装。
    * [ ] NetworkX 库已安装。
    * [ ] Matplotlib（用于基本可视化）已安装。
    * [ ] `requirements.txt` 文件已生成并提交，其中列出了这些依赖项。
* **注意事项:** 在 `README.md` 中指明所选的虚拟环境工具。

---

## 阶段二：数据提取与预处理

---

### **TASK-004: 开发加载上市公司供应商数据脚本 (CSV 1)**
* **描述:** 创建一个 Python 脚本 (`src/ingestion/load_supplier_data.py`)，用于将“上市公司供应商数据”CSV 加载到 Pandas DataFrame 中。
* **验收标准:**
    * [ ] 脚本成功从 `data/raw/listed_company_suppliers.csv` 加载数据。
    * [ ] 数据已加载到 Pandas DataFrame 中。
    * [ ] 已实现基本日志记录（例如，加载的行数，花费的时间）。
    * [ ] 脚本能够妥善处理潜在的文件未找到错误。
    * [ ] 列名与 `data_format.mdc` 中的规范一致。
    * [ ] 初始数据类型已根据 `data_format.mdc` 推断或明确设置。
* **注意事项:** 参考 `pandas.mdc` 获取 DataFrame 最佳实践。如有可能，参数化文件路径。

---

### **TASK-005: 开发加载上市公司客户数据脚本 (CSV 2)**
* **描述:** 创建一个 Python 脚本 (`src/ingestion/load_customer_data.py`)，用于将“上市公司客户数据”CSV 加载到 Pandas DataFrame 中。
* **验收标准:**
    * [ ] 脚本成功从 `data/raw/listed_company_customers.csv` 加载数据。
    * [ ] 数据已加载到 Pandas DataFrame 中。
    * [ ] 已实现基本日志记录。
    * [ ] 脚本能够妥善处理潜在的文件未找到错误。
    * [ ] 列名与 `data_format.mdc` 中的规范一致。
    * [ ] 初始数据类型已推断或明确设置。
* **注意事项:** 结构应与 TASK-004 类似。

---

### **TASK-006: 开发加载供应链公司基本信息脚本 (CSV 3)**
* **描述:** 创建一个 Python 脚本 (`src/ingestion/load_company_info.py`)，用于将“供应链公司基本信息”CSV 加载到 Pandas DataFrame 中。
* **验收标准:**
    * [ ] 脚本成功从 `data/raw/supply_chain_company_info.csv` 加载数据。
    * [ ] 数据已加载到 Pandas DataFrame 中。
    * [ ] 已实现基本日志记录。
    * [ ] 脚本能够妥善处理潜在的文件未找到错误。
    * [ ] 列名与 `data_format.mdc` 中的规范一致。
    * [ ] 初始数据类型已推断或明确设置。
* **注意事项:** 此数据后续可用于丰富节点属性。

---

### **TASK-007: 实现数据清洗和规范化模块**
* **描述:** 开发一个模块 (`src/processing/cleaning.py`)，包含用于对加载的 DataFrame 执行数据清洗和规范化任务的函数。
* **验收标准:**
    * [ ] 用于处理缺失值的函数（根据 `data_format.mdc` 中定义的策略）。
    * [ ] 用于修正数据类型的函数（例如，货币值转为数字，日期转为 datetime 对象）。
    * [ ] 用于规范化公司名称的函数（例如，移除通用后缀如“Ltd.”、“Inc.”；转换为一致的大小写）。
    * [ ] 用于移除或标记重复记录的函数。
    * [ ] 清洗后的数据可以保存到 `data/processed/` 目录。
    * [ ] 所有清洗步骤均已记录日志。
* **注意事项:** 此模块将由主处理脚本使用。考虑公司名称中可能存在的变体。

---

### **TASK-008: 实现数据验证模块**
* **描述:** 开发一个模块 (`src/processing/validation.py`)，包含用于根据预定义规则（例如，预期的列、数据范围、格式）验证数据的函数。
* **验收标准:**
    * [ ] 用于检查必需列是否存在的函数。
    * [ ] 用于验证关键列数据类型的函数。
    * [ ] 用于检查数据完整性的函数（例如，采购/收入金额为正）。
    * [ ] 验证错误/警告已记录详细日志。
    * [ ] 可以生成验证结果的摘要报告。
* **注意事项:** 参考 `data_format.mdc`。确定处理无效记录的策略。

---

### **TASK-009: 合并与整合公司/实体标识符**
* **描述:** 制定策略并实现脚本/函数 (`src/processing/consolidation.py`)，为所有三个数据集中的每个公司/实体创建唯一标识符。
* **验收标准:**
    * [ ] 在公司名称的各种变体与单个唯一 ID 之间建立清晰的映射。
    * [ ] 供应商、客户和公司信息数据可以使用这些唯一 ID 进行链接。
    * [ ] 处理新的或模糊实体的流程已文档化。
    * [ ] 已保存整合后的实体列表/映射。
* **注意事项:** 这是关键步骤。可能涉及模糊匹配或对模糊案例进行手动审查。目标是确保一个文件中的“SupplierA”与另一个文件中的“Supplier A Co.”是同一实体。

---

## 阶段三：供应商网络构建

---

### **TASK-010: 设计网络模式 (Schema)**
* **描述:** 最终确定网络图的设计，包括节点类型、边类型及其各自的属性。
* **验收标准:**
    * [ ] 定义节点类型的文档（例如，“上市公司”、“供应商”、“客户”、“其他供应链公司”）。
    * [ ] 定义边类型的文档（例如，“采购自”、“销售给”）。
    * [ ] 节点的属性列表（例如，`company_name`、`unique_id`、`type`、来自公司信息的 `industry`）。
    * [ ] 边的属性列表（例如，`amount_eur`、`transaction_year`、`product_category`（如果可用））。
* **注意事项:** 此设计将指导 TASK-011 的实现。考虑 NetworkX 中的 `DiGraph` 或 `MultiDiGraph` 是否更合适。

---

### **TASK-011: 基于处理后数据实现网络图构建**
* **描述:** 开发一个脚本 (`src/network/build_network.py`)，用于基于清洗和整合后的数据使用 NetworkX 构建供应链网络。
* **验收标准:**
    * [ ] 脚本加载处理后的数据（阶段二的输出）。
    * [ ] 基于唯一的公司标识符将节点添加到 NetworkX 图中。
    * [ ] 填充节点属性（来自公司信息，或派生）。
    * [ ] 在以下实体间创建有向边：
        * 供应商与上市公司（基于采购数据）。
        * 上市公司与客户（基于收入数据）。
    * [ ] 填充边属性（例如，采购/收入金额）。
    * [ ] 构建的图对象可以保存（例如，GEXF、GraphML 或 pickled 对象）。
* **注意事项:** 确保遵循 `networkx.mdc`。

---

### **TASK-012: 实现边权重计算**
* **描述:** 确保网络中的边被恰当地加权，通常通过金融交易金额（采购额或收入额）。
* **验收标准:**
    * [ ] 代表供应商-公司关系的边具有对应于采购额的“weight”属性。
    * [ ] 代表公司-客户关系的边具有对应于收入额的“weight”属性。
    * [ ] 权重的单位和货币保持一致并已文档化。
    * [ ] 将相同两个实体之间的多个交易聚合为单个边权重的策略已实现（如果不使用 MultiDiGraph）。
* **注意事项:** 此权重对于许多网络分析算法至关重要。

---

## 阶段四：网络分析

---

### **TASK-013: 实现基本网络指标计算**
* **描述:** 在 (`src/network/analysis.py`) 中开发函数，用于计算和报告基本的网络整体指标。
* **验收标准:**
    * [ ] 计算节点总数。
    * [ ] 计算边总数。
    * [ ] 计算网络密度。
    * [ ] 计算平均度数（入度、出度）。
    * [ ] 结果已记录日志或保存到报告中。
* **注意事项:** 使用 NetworkX 内置函数。

---

### **TASK-014: 实现中心性分析**
* **描述:** 实现函数以计算网络中节点的各种中心性指标。
* **验收标准:**
    * [ ] 计算度中心性（每个节点的入度和出度）的函数。
    * [ ] 计算每个节点的介数中心性的函数。
    * [ ] 计算每个节点的特征向量中心性的函数。
    * [ ] （可选）计算紧密中心性的函数。
    * [ ] 结果（按每种中心性指标排名的前 N 个节点）已记录日志或保存。
* **注意事项:** 解释这些中心性在供应链环境中的含义。

---

### **TASK-015: 识别关键供应商和客户**
* **描述:** 利用中心性指标和交易量来识别和报告网络中的关键供应商和关键客户，特别是针对上市公司。
* **验收标准:**
    * [ ] 基于总采购额和/或中心性的前 N 个供应商的报告/列表。
    * [ ] 基于总收入额和/或中心性的前 N 个客户的报告/列表。
    * [ ] 识别对多家上市公司至关重要的供应商/客户。
* **注意事项:** 此任务将 TASK-014 中的分析应用于具体的研究问题。

---

### **TASK-016: (可选) 实现社群检测**
* **描述:** 如果认为相关，则实现算法以检测网络中紧密连接的公司的社群或集群。
* **验收标准:**
    * [ ] 已实现合适的社群检测算法（例如，Louvain 方法）。
    * [ ] 节点已分配到社群。
    * [ ] 已报告有关检测到的社群的基本统计信息（例如，社群数量、规模分布）。
    * [ ] 社群已可视化或列出。
* **注意事项:** 这有助于识别子网络或行业集群。

---

### **TASK-017: (可选) 实现供应链路径分析**
* **描述:** 实现函数以追踪从给定公司到其供应商及其供应商的上游供应链（路径），或到其客户及其客户的下游供应链。
* **验收标准:**
    * [ ] 查找给定公司 N 层内所有上游供应商的函数。
    * [ ] 查找给定公司 N 层内所有下游客户的函数。
    * [ ] 如果数据允许，识别特定产品/公司的最长/最短供应链。
* **注意事项:** 这有助于了解供应链深度和潜在漏洞。

---

## 阶段五：可视化与报告

---

### **TASK-018: 开发基本网络可视化**
* **描述:** 创建脚本 (`src/visualization/plot_network.py`)，使用 Matplotlib 和 NetworkX 的绘图功能生成供应链网络或其子图的静态可视化。
* **验收标准:**
    * [ ] 能够绘制整个网络（可为提高可读性进行简化）。
    * [ ] 能够绘制子图（例如，关键公司的自我中心网络）。
    * [ ] 节点根据属性（例如，类型、中心性）进行着色/调整大小。
    * [ ] 边根据属性进行加权/着色。
    * [ ] 图表保存为图像文件（例如 PNG, SVG）。
* **注意事项:** 对于大型网络，可视化可能具有挑战性。专注于传达关键见解。

---

### **TASK-019: (可选) 开发交互式网络可视化**
* **描述:** 探索并实现使用 Plotly Dash、Bokeh 等库或通过导出到 Gephi 的交互式网络可视化。
* **验收标准:**
    * [ ] 网络可以进行交互式探索（缩放、平移、悬停在节点/边上以获取信息）。
    * [ ] （如果基于 Web）可视化可通过本地 Web 服务器访问。
    * [ ] 数据可以导出为适用于 Gephi 的格式（例如 GEXF）。
* **注意事项:** 这可以显著增强用户探索网络的能力。

---

### **TASK-020: 生成分析结果摘要报告**
* **描述:** 将分析阶段的结果（指标、关键实体、社群结构等）整合到摘要报告中。
* **验收标准:**
    * [ ] 总结关键发现的 Markdown 或 PDF 文档。
    * [ ]呈现重要指标和列表（例如，排名前 10 的中心公司）的表格和图表。
    * [ ] 包含在 TASK-018/TASK-019 中生成的相关可视化。
    * [ ] 在供应链研究的背景下对发现进行解读。
* **注意事项:** 此报告将是项目的关键交付成果。存储在 `docs/reports/` 中。

---

## 阶段六：文档与最终确定

---

### **TASK-021: 更新项目文档**
* **描述:**审查并更新所有项目文档，包括 `README.md`、代码中的注释、文档字符串以及任何分析报告。
* **验收标准:**
    * [ ] `README.md` 准确反映项目的最终状态、设置和用法。
    * [ ] 所有主要函数和类都具有符合 `python.mdc` 的清晰文档字符串。
    * [ ] 复杂代码段有充分注释。
    * [ ] `DEV_PLAN.md` 已更新以反映已完成的任务（此任务本身将标记最终更新）。
* **注意事项:** 良好的文档对于可复现性和未来工作至关重要。

---

### **TASK-022: 代码审查与完善**
* **描述:** 对整个代码库进行彻底审查，以确保其清晰性、效率、对编码标准的遵守以及正确性。
* **验收标准:**
    * [ ] 代码由至少另一人审查（如果可能）或进行严格的自我审查。
    * [ ] 已识别的问题、错误或需要改进的领域得到解决。
    * [ ] 代码格式一致（例如，使用 Black 或 autopep8）。
    * [ ] 所有定义的 Cursor 规则均得到遵守。
* **注意事项:** 这确保了最终代码库的质量。

---

### **TASK-023: 项目最终归档/演示准备**
* **描述:** 准备项目以进行归档或演示，确保所有可交付成果均已最终确定并整理完毕。
* **验收标准:**
    * [ ] 代码的最终版本已提交并推送到 `main` 分支。
    * [ ] 所有相关数据（原始数据、处理后数据、结果）均已整理并文档化。
    * [ ] 最终报告和可视化已完成。
    * [ ] （如果适用）演示材料已准备就绪。
* **注意事项:** 确保项目处于易于理解并可能由他人在未来接手的状态。

---